# GRAVITAS IMPLEMENTATION PLAN: PHASE 4.1 (Memory Migration)

**Objective:** Migrate from Legacy ChromaDB to Omni-RAG (Qdrant + MinIO) and implement VRAM-safe Mode Switching.

## 1. Infrastructure Scaffolding (The "Sidecar" Support)
- [ ] **Refactor `app/container.py`:**
    - Implement `switch_model(target: str)` method.
    - Logic: Call `ollama_client.unload()` -> `ollama_client.pull(target)`.
    - **Test:** Create `tests/test_model_swap.py` (Mock the unload/load cycle).

## 2. Storage Layer (MinIO)
- [ ] **Create `app/storage.py`:**
    - Implement `ObjectStore` class wrapping `Minio`.
    - Methods: `upload_text(key, text)`, `get_text(key)`.
    - **Test:** Create `tests/test_minio_storage.py` (Priority 1 in Audit).

## 3. Memory Layer (Qdrant Migration)
- [ ] **Update `app/memory.py`:**
    - Replace `ChromaDB` logic with `QdrantClient`.
    - Implement `add_texts` to split data: Vector -> Qdrant, Text -> MinIO.
    - **Test:** Update `tests/test_memory_logic.py` to target Qdrant (Priority 2 in Audit).

## 4. Verification
- [ ] **Run `pytest tests/`:** Ensure all 3 new/updated tests pass.
- [ ] **Generate Receipt:** Create `completed_phase4.1.md`.