# GRAVITAS ARCHITECTURAL CONSTITUTION (patterns.md)
# STATUS: ENFORCED
# VIOLATION STRATEGY: IMMEDIATE REJECTION

## 1. THE SWITCHBOARD (Dependency Injection)
* **Principle:** Inversion of Control (IoC).
* **Law:** No class may instantiate `QdrantClient`, `MinioClient`, or `Ollama` drivers directly.
* **Enforcement:** All external services MUST be injected via `app.container.Container`.
* **Reference:** `app/container.py`

## 2. THE MEMORY VAULT (Hybrid RAG)
* **Principle:** The "Gravitas Grounded Research" Separation.
* **Law:**
    1.  **Vectors:** MUST go to `Qdrant` (Port 6333).
    2.  **Blobs:** Raw text/PDFs MUST go to `MinIO` (Port 9000).
    3.  **Logs:** Chat history MUST go to `Postgres` (Port 5432).
* **Anti-Pattern:** Storing raw text in Qdrant payloads (VRAM waste). Storing vectors in Postgres (Slow).

## 3. THE REFLEX (Command Pattern)
* **Principle:** Atomic Actions.
* **Law:** All side effects (Shell, Git, File Write) must be encapsulated in a `<reflex>` XML tag.
* **Enforcement:** The `app.router` parses the XML. The `app.safety` module validates it. The `app.reflex` module executes it.
* **Forbidden:** Direct `subprocess.run()` calls inside the LLM context.

## 4. THE SHIFT WORKER (Resource Allocation)
* **Principle:** Dual-GPU Segmentation.
* **Law:**
    * **GPU 0 (Titan):** Reserved for Generation (L1/L2).
    * **GPU 1 (GTX 1060):** Reserved for Embeddings/Reranking.
* **Enforcement:** `CUDA_VISIBLE_DEVICES` environment variable must be strictly set per container.

## 5. THE BUILDER'S CONTRACT (TDD)
* **Principle:** Red-Green-Refactor.
* **Law:** No feature code without a failing `pytest` entry.
* **Receipt:** Every completed task must append the test result log to `completed.md`.