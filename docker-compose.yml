version: '3.8'

services:
  rag_app:
    build: .
    container_name: agy_rag_backend
    ports:
      - "5050:5050"
    environment:
      # OLLAMA_URL: Point to the special Docker DNS for "The Host Machine"
      - OLLAMA_URL=http://host.docker.internal:11434
      - PORT=5050
      - USER_NAME=Dan
      - MODEL=codellama:7b
    # This extra_hosts entry is the magic bridge for Linux/WSL containers
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      # Optional: Mount code for live reloading during dev
      # - ./app:/app/app
      # Persistent memory (SQLite) mapping
      - ./memory.db:/app/memory.db